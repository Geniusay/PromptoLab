server:
  port: 8080

spring:
  application:
    name: poet-agent
  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://117.72.211.46:5432/promptolab}
    username: ${SPRING_DATASOURCE_USERNAME:root}
    password: ${SPRING_DATASOURCE_PASSWORD:tmlis666}
    driver-class-name: ${SPRING_DATASOURCE_DRIVER_CLASS_NAME:org.postgresql.Driver}
    hikari:
      # 连接最大生命周期（毫秒），设置为比数据库超时时间短
      max-lifetime: 900000    # 15分钟（从30分钟减少到15分钟）
      # 连接空闲超时时间
      idle-timeout: 300000    # 5分钟（从10分钟减少到5分钟）
      # 连接验证超时时间
      validation-timeout: 3000  # 3秒（从5秒减少到3秒）
      # 连接测试查询
      connection-test-query: SELECT 1
      # 连接池最小空闲连接数
      minimum-idle: 2         # 从5减少到2
      # 连接池最大连接数
      maximum-pool-size: 10   # 从20减少到10
      # 获取连接超时时间
      connection-timeout: 20000  # 20秒（从30秒减少到20秒）
      # 是否自动提交
      auto-commit: true
      # 新增：连接泄漏检测时间（毫秒）
      leak-detection-threshold: 60000  # 60秒
      # 新增：是否在获取连接时验证连接
      connection-init-sql: SELECT 1
      # 新增：连接池名称，便于监控
      pool-name: HikariCP-PoetAgent
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
    open-in-view: false
ai:
  # 持久化配置
  persistence:
    data-dir: ${AI_PERSISTENCE_DATA_DIR:classpath:ai-config}
    backup-dir: ${AI_PERSISTENCE_BACKUP_DIR:./data/ai-config/backups}
    auto-backup: ${AI_PERSISTENCE_AUTO_BACKUP:true}
    backup-retention-days: ${AI_PERSISTENCE_BACKUP_RETENTION_DAYS:30}

